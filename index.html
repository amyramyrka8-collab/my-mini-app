<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø±ÙƒØ² Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script src='//libtl.com/sdk.js' data-zone='10449377' data-sdk='show_10449377'></script>

    <style>
        body { font-family: sans-serif; background-color: #f0f2f5; text-align: center; padding: 15px; }
        .card { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        .stats-container { display: flex; justify-content: space-around; margin-bottom: 20px; background: #f9f9f9; padding: 15px; border-radius: 15px; border: 1px solid #eee; }
        .stat-value { font-size: 18px; font-weight: bold; color: #0088cc; display: block; }
        .stat-label { font-size: 12px; color: #777; }
        .btn { width: 100%; padding: 12px; border-radius: 12px; border: none; font-size: 16px; font-weight: bold; cursor: pointer; margin: 8px 0; color: white; }
        .btn-watch { background: #0088cc; }
        .btn-invite { background: #6f42c1; }
        .btn-withdraw { background: #888888; opacity: 0.7; }
        .info-text { font-size: 13px; color: #d9534f; margin: 10px 0; font-weight: bold; }
    </style>
</head>
<body>
    <div class="card">
        <h2>ðŸ’° Ù…Ø±ÙƒØ² Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h2>
        
        <div class="stats-container">
            <div class="stat-item">
                <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</span>
                <span id="balance-display" class="stat-value">0.0000$</span>
            </div>
            <div class="stat-item" style="border-right: 1px solid #ddd;">
                <span class="stat-label">Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</span>
                <span id="views-display" class="stat-value">0</span>
            </div>
        </div>

        <p class="info-text">ÙƒÙ„ 20 Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù€ 0.001$</p>

        <button class="btn btn-watch" onclick="handleAdRotation()">ðŸ“º Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¥Ø¹Ù„Ø§Ù†</button>
        <button class="btn btn-invite" onclick="inviteFriend()">ðŸ”— Ø¯Ø¹ÙˆØ© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ (0.005$)</button>
        <button class="btn btn-withdraw" onclick="tg.showAlert('Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø³Ø­Ø¨ Ù‚Ø±ÙŠØ¨Ø§Ù‹!')">ðŸ’³ Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (Ù‚Ø±ÙŠØ¨Ø§Ù‹)</button>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        let views = parseInt(localStorage.getItem('views')) || 0;
        let balance = parseFloat(localStorage.getItem('balance')) || 0.0;
        let adStep = parseInt(localStorage.getItem('adStep')) || 1; // Ù„ØªØªØ¨Ø¹ Ø£ÙŠ Ø¥Ø¹Ù„Ø§Ù† Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø¯ÙˆØ±

        updateDisplays();

        function updateDisplays() {
            document.getElementById('views-display').innerText = views;
            document.getElementById('balance-display').innerText = balance.toFixed(4) + "$";
        }

        function handleAdRotation() {
            if (typeof show_10449377 !== 'function') {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨ØªØŒ Ù†ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙÙˆØ±Ø§Ù‹
                openDirectLink();
                return;
            }

            if (adStep === 1) {
                // 1. Ø¥Ø¹Ù„Ø§Ù† Ø¨ÙŠÙ†ÙŠ Ø¹Ø§Ø¯ÙŠ
                show_10449377().then(() => { processReward(2); }).catch(nextStep);
            } 
            else if (adStep === 2) {
                // 2. Ø¥Ø¹Ù„Ø§Ù† Ø¨ÙŠÙ†ÙŠ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                show_10449377({ type: 'inApp', inAppSettings: { timeout: 1, interval: 30, frequency: 1 } }).then(() => { processReward(3); }).catch(nextStep);
            } 
            else if (adStep === 3) {
                // 3. Ø¥Ø¹Ù„Ø§Ù† Ù…ÙƒØ§ÙØ£Ø© (Pop)
                show_10449377('pop').then(() => { processReward(4); }).catch(nextStep);
            } 
            else {
                // 4. Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±
                openDirectLink();
            }
        }

        function openDirectLink() {
            tg.openLink("https://otieu.com/4/10449394");
            // Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù†Ø¹ØªØ¨Ø±Ù‡ ØªÙ…Øª Ù…Ø´Ø§Ù‡Ø¯ØªÙ‡ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù
            setTimeout(() => { processReward(1); }, 5000);
        }

        function nextStep() {
            // ÙÙŠ Ø­Ø§Ù„ ÙØ´Ù„ Ø¥Ø¹Ù„Ø§Ù†ØŒ Ù†Ù†ØªÙ‚Ù„ Ù„Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            adStep = adStep >= 4 ? 1 : adStep + 1;
            localStorage.setItem('adStep', adStep);
            handleAdRotation();
        }

        function processReward(nextAdStep) {
            views++;
            if (views % 20 === 0) { balance += 0.001; }
            
            // ØªØ­Ø¯ÙŠØ« Ø®Ø·ÙˆØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„ØªØ§Ù„ÙŠØ©
            adStep = nextAdStep;
            localStorage.setItem('adStep', adStep);
            
            saveData();
        }

        function saveData() {
            localStorage.setItem('views', views);
            localStorage.setItem('balance', balance);
            updateDisplays();
            tg.sendData("ad_watched");
        }

        function inviteFriend() {
            const botUsername = "PointsAdsbot"; 
            const inviteLink = `https://t.me/${botUsername}?start=${tg.initDataUnsafe.user.id}`;
            const text = encodeURIComponent("Ø§Ø±Ø¨Ø­ Ø§Ù„Ù…Ø§Ù„ Ù…Ù† Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª! ðŸ’°");
            tg.openTelegramLink(`https://t.me/share/url?url=${inviteLink}&text=${text}`);
        }
    </script>
</body>
</html>
